import pandas as pd
from typing import List, Tuple

def dehorn_trend(data: List[Tuple[pd.Timestamp, bool]]) -> List[Tuple[pd.Timestamp, bool]]:
    """
    Restituisce solo le coppie in cui lo stato (True/False) cambia, 
    mantenendo l'ultima occorrenza di ogni sequenza identica.

    >>> data = [(pd.to_datetime('1.1.1989'), True), (pd.to_datetime('1.1.1990'), False), (pd.to_datetime('1.1.1995'), False)]
    >>> dehorn_trend(data)
    [(pd.Timestamp('1989-01-01 00:00:00'), True), (pd.Timestamp('1995-01-01 00:00:00'), False)]
    """
    if not data:
        return []

    result = []
    
    # Iteriamo sulla lista confrontando l'elemento corrente con il successivo
    for i in range(len(data)):
        current_state = data[i][1]
        
        # Se siamo all'ultimo elemento OPPURE lo stato successivo è diverso
        if i == len(data) - 1 or data[i+1][1] != current_state:
            result.append(data[i])
            
    return result

# Esecuzione del test
if __name__ == "__main__":
    import doctest
    doctest.testmod()

# PRE-REQUISITO: Caricamento e conversione (da fare una volta sola)
df = pd.read_csv('rhinos.csv', sep=';')
df['Date'] = pd.to_datetime(df['Date'], format='%d.%m.%Y')
df['is_dehorned'] = df['Horn'] == 'Dehorned'

# --- INIZIO ESERCIZIO 4 ---

# 1. Filtriamo usando i nomi reali del file
rhino_data = df[df['RhinosAtSighting'] == 'MPGRBF-02-05'].copy()

# 2. Ordiniamo per 'Date' (maiuscola come nel CSV)
rhino_data = rhino_data.sort_values('Date')

# 3. Creiamo la lista di tuple usando le colonne corrette
rhino_list = list(zip(rhino_data['Date'], rhino_data['is_dehorned']))

# 4. Applichiamo la funzione (che rimane identica, è perfetta così!)
trend_result = dehorn_trend(rhino_list)

# 5. Visualizziamo
print(f"Trend dei cambiamenti per il rinoceronte MPGRBF-02-05:")
for date, state in trend_result:
    status_str = "Dehorned" if state else "Horned"
    print(f"- Data: {date.strftime('%Y-%m-%d')} | Stato: {status_str}")
